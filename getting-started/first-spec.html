<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">Your first specification | Gospel</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ocaml-gospel.github.io/gospel/getting-started/first-spec"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Your first specification | Gospel"><meta data-rh="true" name="description" content="Let us get started with a simple specification example, and specify a generic"><meta data-rh="true" property="og:description" content="Let us get started with a simple specification example, and specify a generic"><link data-rh="true" rel="canonical" href="https://ocaml-gospel.github.io/gospel/getting-started/first-spec"><link data-rh="true" rel="alternate" href="https://ocaml-gospel.github.io/gospel/getting-started/first-spec" hreflang="en"><link data-rh="true" rel="alternate" href="https://ocaml-gospel.github.io/gospel/getting-started/first-spec" hreflang="x-default"><link rel="stylesheet" href="/gospel/assets/css/styles.665d06b1.css">
<link rel="preload" href="/gospel/assets/js/runtime~main.11528e05.js" as="script">
<link rel="preload" href="/gospel/assets/js/main.960f9adc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gospel/"><b class="navbar__title">Gospel</b></a><a class="navbar__item navbar__link navbar__link--active" href="/gospel/">Docs</a><a class="navbar__item navbar__link" href="/gospel/stdlib">Standard Library</a><a class="navbar__item navbar__link" href="/gospel/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ocaml-gospel/gospel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gospel/">Welcome!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/gospel/getting-started/installation">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/getting-started/installation">Installing Gospel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gospel/getting-started/first-spec">Your first specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/getting-started/tools">Now what?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gospel/getting-started/going-further">Going further</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gospel/walkthroughs/introduction">Walk-throughs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gospel/language/locations">Language specification</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gospel/good-practices">Tips and Good Practices</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/gospel/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Getting Started</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/gospel/getting-started/first-spec">Your first specification</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Your first specification</h1><p>Let us get started with a simple specification example, and specify a generic
interface for polymorphic, limited capacity containers.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** The type for containers. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">exception</span><span class="token plain"> Full</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** [create capacity] is an empty container whose maximum capacity</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    is [capacity]. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> is_empty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** [is_empty t] is [true] iff [t] contains no elements. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> clear</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** [clear t] removes all values in [t]. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** [add t x] adds [x] to the container [t], or raises [Full] if</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    [t] has reached its maximum capacity. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> mem</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** [mem t x] is [true] iff [t] contains [x]. *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Gospel specifications live in special comments, starting with the <code>@</code> character.
These comments may be attached to type declarations or value declarations. They
provide a specification for the signature item they are attached to.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="models-and-invariants-for-a-t">Models and invariants for <code>&#x27;a t</code><a class="hash-link" href="#models-and-invariants-for-a-t" title="Direct link to heading">‚Äã</a></h2><p>Let&#x27;s start by specifying the abstract type <code>&#x27;a t</code>. As a container with fixed
capacity, we can model it with two bits of information: a fixed integer
capacity, and a set of <code>&#x27;a</code> values, representing its contents. Note that the
capacity is not mutable, while the contents are. This logical model of
the container directly translates into Gospel:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(** The type for containers. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ model capacity: int</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    mutable model contents: &#x27;a set *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Notice that documentation comments and Gospel specifications can coexist and
often even help understand each other! However, for the sake of brevity, we will
omit docstrings in the rest of this section.</p><p>One may also note that the capacity must be positive and that the number of values
in the <code>contents</code> set may not exceed <code>capacity</code>. Those are type invariants:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ model capacity: int</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    mutable model contents: &#x27;a set</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    invariant capacity &gt; 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    invariant Set.cardinal contents &lt;= capacity *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>Set</code> module is part of the <a href="/gospel/stdlib">Gospel standard library</a>. Although it
tries to mimic familiar interfaces from the OCaml standard library, those two
should not be confused: logical declarations can only appear in specifications.</p><p>Now that we annotated our type with its models and invariants, we can attach
specifications to the functions to show how they interact with the container.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="your-first-function-contract-create">Your first function contract: <code>create</code><a class="hash-link" href="#your-first-function-contract-create" title="Direct link to heading">‚Äã</a></h2><p>The function <code>create</code> returns a container when provided a capacity. We may want
to specify three bits of information:</p><ul><li>The provided capacity is positive.</li><li>The capacity of the returned container is indeed the one received as an
argument.</li><li>The container is empty.</li></ul><p>Let&#x27;s write a Gospel formalisation of that contract. The contract starts with a
header that lets us name the arguments and return value (we will call the
argument <code>c</code> and the return value <code>t</code>) to mention them in the rest of the
specification. The first property is a pre-condition of the function (we use the
keyword <code>requires</code>), while the second and third ones are post-conditions (the
keyword is <code>ensures</code>):</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ t = create c</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    requires c &gt; 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures t.capacity = c</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures t.contents = Set.empty *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="simple-accessors-is_empty-and-mem">Simple accessors: <code>is_empty</code> and <code>mem</code><a class="hash-link" href="#simple-accessors-is_empty-and-mem" title="Direct link to heading">‚Äã</a></h2><p>Now on to <code>is_empty</code> and <code>mem</code>.</p><p><code>is_empty t</code> is true if and only if <code>t</code> is empty; this is a post-condition. This
function also (hopefully) has no side-effect: it does not modify <code>t</code>, does not
depend on any internal state, and does not raise exceptions. In Gospel&#x27;s
language, this function is <em>pure</em>.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> is_empty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ b = is_empty t</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    pure</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures b &lt;-&gt; t.contents = Set.empty *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The specification for <code>mem</code> is similar:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> mem</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ b = mem t x</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    pure</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures b &lt;-&gt; Set.mem x t.contents *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="mutating-arguments-and-raising-exceptions">Mutating arguments and raising exceptions<a class="hash-link" href="#mutating-arguments-and-raising-exceptions" title="Direct link to heading">‚Äã</a></h2><p>Finally, let us specify <code>clear</code> and <code>add</code>, which are functions that mutate the
container.</p><p>The function <code>clear</code> removes all elements from its argument: it is empty after the
call. Obviously, it modifies the <code>contents</code> model of its argument. After its
execution, the container should be empty. Note that we are only allowed to
mention <code>is_empty</code> in the specification because it is a pure function;
attempting to use a non-pure OCaml function in a specification will result in a
Gospel error.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> clear</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ clear t</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies t.contents</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures is_empty t *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A first attempt at specifying <code>add</code> is similar to the previous examples. We use
Gospel&#x27;s <code>old</code> primitive to refer to the state of the container prior to the
function execution:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ add t x</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies t.contents</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures t.contents = Set.add x (old t.contents) *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Notice, however, that this specification is incomplete. Indeed, one specificity
of this function is that it can raise <code>Full</code>. Let us complete that contract with
this bit of information. If <code>add</code> raises <code>Full</code>, we can deduce that <code>t.contents</code>
already contains <code>t.capacity</code> elements.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">val</span><span class="token plain"> add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:rgb(153, 76, 195);font-style:italic">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-&gt;</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">(*@ add t x</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    modifies t.contents</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    ensures t.contents = Set.add x (old t.contents)</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">    raises Full -&gt; Set.cardinal (old t.contents) = t.capacity</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">                /\ t.contents = old t.contents *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Since we have a <code>modifies</code> clause, the contents of <code>t</code> may be mutated even when
<code>Full</code> is raised. The last line of specification forbids such a behavior.</p><p>Notice how we did not need to repeat that <code>S.cardinal t.contents &lt;= t.capacity</code>
in every contract; as a type invariant, this property implicitly holds in every
function&#x27;s pre-state and post-state.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="type-checking-your-specification">Type-checking your specification<a class="hash-link" href="#type-checking-your-specification" title="Direct link to heading">‚Äã</a></h2><p>We&#x27;re done! Our module interface is fully specified, independently of any
implementation. The full example is available in
<a target="_blank" href="/gospel/assets/files/container-ed0b215e06012568c6d7892aae309f83.mli">container.mli</a> in case you want to play with it.
Let&#x27;s finish by verifying that these are well-typed, and call Gospel&#x27;s
type-checker:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">$ gospel check ./container.mli</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">OK</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gospel/getting-started/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Installing Gospel</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gospel/getting-started/tools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Now what?</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#models-and-invariants-for-a-t" class="table-of-contents__link toc-highlight">Models and invariants for <code>&#39;a t</code></a></li><li><a href="#your-first-function-contract-create" class="table-of-contents__link toc-highlight">Your first function contract: <code>create</code></a></li><li><a href="#simple-accessors-is_empty-and-mem" class="table-of-contents__link toc-highlight">Simple accessors: <code>is_empty</code> and <code>mem</code></a></li><li><a href="#mutating-arguments-and-raising-exceptions" class="table-of-contents__link toc-highlight">Mutating arguments and raising exceptions</a></li><li><a href="#type-checking-your-specification" class="table-of-contents__link toc-highlight">Type-checking your specification</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2020‚Äî2022 Gospel maintainers.</div></div></div></footer></div>
<script src="/gospel/assets/js/runtime~main.11528e05.js"></script>
<script src="/gospel/assets/js/main.960f9adc.js"></script>
</body>
</html>